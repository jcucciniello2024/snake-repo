<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Educational Snake JS</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --snake-body: #22c55e;
            --snake-head: #4ade80;
            --food: #ef4444;
            --grid-line: #1e293b;
        }

        body {
            background-color: var(--bg-color);
            color: white;
            font-family: 'Segoe UI', system-ui, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            overflow: hidden;
        }

        .game-header { text-align: center; margin: 10px 0; }
        
        #game-container {
            position: relative;
            border: 4px solid #334155;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        canvas { display: block; background-color: #020617; }

        .stats-panel {
            display: flex;
            gap: 20px;
            margin: 15px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .edu-sidebar {
            max-width: 600px;
            background: #1e293b;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .code-highlight { color: #fbbf24; font-family: monospace; }
        
        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(15, 23, 42, 0.9);
            padding: 20px;
            text-align: center;
            border: 2px solid var(--food);
            display: none;
        }
    </style>
</head>
<body>

    <div class="game-header">
        <h1>Logic Snake</h1>
        <p>Use Arrow Keys or WASD to navigate the grid</p>
    </div>

    <div class="stats-panel">
        <div>Score: <span id="score">0</span></div>
        <div>Speed: <span id="speed">1.0</span>x</div>
    </div>

    <div id="game-container">
        <canvas id="snakeCanvas" width="400" height="400"></canvas>
        <div id="game-over">
            <h2>GAME OVER</h2>
            <p>The snake hit a boundary or itself.</p>
            <button onclick="resetGame()" style="padding: 10px 20px; cursor:pointer;">Try Again</button>
        </div>
    </div>

    <div class="edu-sidebar">
        <strong>The "Snake Brain" Logic:</strong>
        <ul>
            <li><strong>The Grid:</strong> The canvas is divided into 20x20 pixel squares. We track the snake as an <span class="code-highlight">Array of Objects</span>: <code>[{x: 10, y: 10}, ...]</code>.</li>
            <li><strong>Movement:</strong> On every frame, we add a new head based on the current direction and <span class="code-highlight">.pop()</span> the last element (the tail).</li>
            <li><strong>Growth:</strong> If the new head coordinates match the food coordinates, we skip the <code>.pop()</code>, making the array longer!</li>
        </ul>
    </div>

    <script>
        const canvas = document.getElementById("snakeCanvas");
        const ctx = canvas.getContext("2d");
        const scoreEl = document.getElementById("score");
        const speedEl = document.getElementById("speed");
        const gameOverEl = document.getElementById("game-over");

        const gridSize = 20;
        const tileCount = canvas.width / gridSize;

        let score = 0;
        let dx = 0; // Horizontal velocity
        let dy = 0; // Vertical velocity
        let snake = [{x: 10, y: 10}];
        let food = {x: 5, y: 5};
        let gameSpeed = 100;
        let gameLoopTimeout;

        // 1. Core Game Loop
        function main() {
            if (didGameEnd()) {
                gameOverEl.style.display = "block";
                return;
            }

            gameLoopTimeout = setTimeout(function onTick() {
                clearCanvas();
                drawFood();
                advanceSnake();
                drawSnake();
                main();
            }, gameSpeed);
        }

        // 2. Painting the Scene
        function clearCanvas() {
            ctx.fillStyle = "#020617";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw subtle grid lines
            ctx.strokeStyle = "#1e293b";
            for(let i=0; i<canvas.width; i+=gridSize) {
                ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); ctx.stroke();
            }
        }

        function drawSnake() {
            snake.forEach((part, index) => {
                ctx.fillStyle = (index === 0) ? "#4ade80" : "#22c55e";
                ctx.fillRect(part.x * gridSize, part.y * gridSize, gridSize - 2, gridSize - 2);
            });
        }

        function advanceSnake() {
            const head = { x: snake[0].x + dx, y: snake[0].y + dy };
            snake.unshift(head);

            const didEatFood = snake[0].x === food.x && snake[0].y === food.y;
            if (didEatFood) {
                score += 10;
                scoreEl.innerHTML = score;
                createFood();
                // Increase speed slightly
                if (gameSpeed > 50) gameSpeed -= 2;
                speedEl.innerHTML = (100 / gameSpeed).toFixed(1);
            } else {
                if(dx !== 0 || dy !== 0) snake.pop();
            }
        }

        // 3. Logic & Collision
        function didGameEnd() {
            if (dx === 0 && dy === 0) return false;
            const hitLeft = snake[0].x < 0;
            const hitRight = snake[0].x > tileCount - 1;
            const hitTop = snake[0].y < 0;
            const hitBottom = snake[0].y > tileCount - 1;

            for (let i = 4; i < snake.length; i++) {
                if (snake[i].x === snake[0].x && snake[i].y === snake[0].y) return true;
            }
            return hitLeft || hitRight || hitTop || hitBottom;
        }

        function createFood() {
            food.x = Math.floor(Math.random() * tileCount);
            food.y = Math.floor(Math.random() * tileCount);
            // Don't spawn food on snake body
            snake.forEach(part => {
                if (part.x === food.x && part.y === food.y) createFood();
            });
        }

        function drawFood() {
            ctx.fillStyle = "#ef4444";
            ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize - 2, gridSize - 2);
        }

        // 4. Controls
        function changeDirection(event) {
            const LEFT_KEY = 37, RIGHT_KEY = 39, UP_KEY = 38, DOWN_KEY = 40;
            const W = 87, A = 65, S = 83, D = 68;

            const keyPressed = event.keyCode;
            const goingUp = dy === -1;
            const goingDown = dy === 1;
            const goingRight = dx === 1;
            const goingLeft = dx === -1;

            if ((keyPressed === LEFT_KEY || keyPressed === A) && !goingRight) { dx = -1; dy = 0; }
            if ((keyPressed === UP_KEY || keyPressed === W) && !goingDown) { dx = 0; dy = -1; }
            if ((keyPressed === RIGHT_KEY || keyPressed === D) && !goingLeft) { dx = 1; dy = 0; }
            if ((keyPressed === DOWN_KEY || keyPressed === S) && !goingUp) { dx = 0; dy = 1; }
        }

        function resetGame() {
            score = 0; dx = 0; dy = 0;
            snake = [{x: 10, y: 10}];
            gameSpeed = 100;
            scoreEl.innerHTML = score;
            speedEl.innerHTML = "1.0";
            gameOverEl.style.display = "none";
            clearTimeout(gameLoopTimeout);
            createFood();
            main();
        }

        document.addEventListener("keydown", changeDirection);
        createFood();
        main();
    </script>
</body>
</html>
